{"$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#","contentVersion":"1.0.0.0","parameters":{"analytic-id":{"defaultValue":"ba67d4e8-16eb-404a-8d1a-3e036a1be1a2","metadata":{"description":"Unique id for the scheduled alert rule"},"minLength":1,"type":"string"},"workspace":{"type":"String"}},"resources":[{"apiVersion":"2021-10-01","kind":"Scheduled","name":"[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',parameters('analytic-id'))]","properties":{"alertRuleTemplateName":"757e8940-a829-4eab-a7a3-bd01a3690960","description":"This is a test rule","displayName":"Table Retention Modified","enabled":"true","entityMappings":[{"entityType":"File","fieldMappings":[{"identifier":"Name","columnName":"modifiedTable"}]}],"eventGroupingSettings":{"aggregationKind":"SingleAlert"},"incidentConfiguration":{"createIncident":"true","groupingConfiguration":{"enabled":"true","groupByEntities":[],"lookbackDuration":"PT5H","matchingMethod":"AllEntities","reopenClosedIncident":"false"}},"query":"AzureActivity\r\n//This is a sample comment\r\n| where TimeGenerated >= ago(90d)\r\n| where ActivityStatus has 'succeeded'\r\n| where OperationName has 'tables/write'\r\n| extend modifiedTable = extract('tables/(.*)', 1, _ResourceId)\r\n| summarize arg_max(TimeGenerated, *) by modifiedTable\r\n| project ['Last Modified Time'] = TimeGenerated, modifiedTable","queryFrequency":"PT5H","queryPeriod":"PT5H","severity":"Medium","suppressionDuration":"PT5H","suppressionEnabled":"false","tactics":["Impact"],"triggerOperator":"GreaterThan","triggerThreshold":0},"type":"Microsoft.OperationalInsights/workspaces/providers/alertRules"}]}