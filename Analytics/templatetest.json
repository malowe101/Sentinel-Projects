{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
      "workspace": {
          "type": "String"
      }
  },
  "resources": [
      {
          "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/88a99f44-3e8d-4a64-99bd-7c9d1af28dd7')]",
          "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/88a99f44-3e8d-4a64-99bd-7c9d1af28dd7')]",
          "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
          "kind": "Scheduled",
          "apiVersion": "2021-09-01-preview",
          "properties": {
              "displayName": "Cloudflare - WAF Allowed threat",
              "description": "Detects WAF \"Allowed\" action on threat events.",
              "severity": "High",
              "enabled": false,
              "query": "Cloudflare\n| where isnotempty(WAFRuleID) or isnotempty(WAFRuleMessage)\n| where WAFAction =~ 'Allow'\n| extend IPCustomEntity = SrcIpAddr\n| extend UrlCustomEntity = ClientRequestURI\n",
              "queryFrequency": "PT1H",
              "queryPeriod": "PT1H",
              "triggerOperator": "GreaterThan",
              "triggerThreshold": 0,
              "suppressionDuration": "PT1H",
              "suppressionEnabled": false,
              "tactics": [
                  "InitialAccess"
              ],
              "techniques": [],
              "alertRuleTemplateName": null,
              "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                      "enabled": false,
                      "reopenClosedIncident": false,
                      "lookbackDuration": "PT5M",
                      "matchingMethod": "AllEntities",
                      "groupByEntities": [],
                      "groupByAlertDetails": null,
                      "groupByCustomDetails": null
                  }
              },
              "eventGroupingSettings": null,
              "alertDetailsOverride": null,
              "customDetails": null,
              "entityMappings": null
          }
      }
  ]
}
